# vRain GUI版本使用指南

## 简介

vRain GUI是vRain古籍刻本电子书制作工具的图形界面版本，提供了友好的用户界面，让您可以通过鼠标点击来配置参数和生成PDF文件。

vRain支持两种工作模式：
- **单文件模式**: 直接处理指定的文本文件
- **书籍ID模式**: 基于书籍ID处理books目录下的多个文本文件

## 系统要求

- Python 3.8 或更高版本
- Windows 10+、macOS 10.14+、Ubuntu 18.04+ 或其他Linux发行版
- 已安装vRain的所有依赖包

### 必需依赖包
```
reportlab
Pillow
opencc-python-reimplemented
```

### 可选依赖包（PDF压缩功能）
```
Ghostscript (gs命令)
```

## 安装和运行

vRain提供了两个GUI版本：

### 1. 单文件模式GUI（基于vrain.py）
适用于处理单个文本文件

#### Windows用户
1. 双击运行 `run_gui.bat` 文件
2. 或者在命令行中运行：
   ```bash
   python run_gui.py
   ```

#### macOS/Linux用户
1. 在终端中运行：
   ```bash
   python run_gui.py
   ```

### 2. 书籍ID模式GUI（基于vrain_back.py）
适用于处理books目录下的多个文本文件

#### Windows用户
1. 双击运行 `run_back_gui.bat` 文件
2. 或者在命令行中运行：
   ```bash
   python run_back_gui.py
   ```

#### macOS/Linux用户
1. 在终端中运行：
   ```bash
   python run_back_gui.py
   ```

### 方法3：直接运行
```bash
# 单文件模式
python vrain_gui.py

# 书籍ID模式
python vrain_back_gui.py
```

## 功能特性

### 核心功能
- **古籍刻本风格**: 生成传统古籍直排样式的PDF
- **多字体支持**: 自动检测和使用支持中文字符的字体
- **简繁转换**: 支持简体繁体字符自动转换
- **章节处理**: 支持自动识别和处理章节标题
- **批注支持**: 支持【批注】格式的注释文本
- **页面范围**: 支持指定起始页和结束页
- **测试模式**: 支持生成少量页面用于调试

### 文本处理功能
- **标点符号处理**: 支持标点符号替换、删除、归一化
- **特殊字符**: 支持@（空格）、书名号等特殊字符处理
- **段落补齐**: 自动计算和补齐段落末尾空格
- **编码支持**: 支持UTF-8编码的文本文件

### 排版功能
- **直排布局**: 传统古籍从右到左、从上到下的排版
- **多列布局**: 支持自定义列数和列宽
- **字体大小**: 支持正文和注释不同字体大小
- **页面边距**: 支持自定义页面边距
- **背景图片**: 支持自定义背景图片

## 界面说明

### 单文件模式GUI界面

#### 1. 文件选择区域
- **文本文件**: 选择要处理的文本文件（.txt格式，必需）
- **书籍配置**: 选择书籍配置文件（.cfg格式，必需）
- **封面文件**: 选择封面图片文件（.jpg、.png格式，可选，留空将创建简易封面）

#### 2. 快速选择按钮
- **史记示例**: 自动加载史记的配置文件和文本
- **神武天帝示例**: 自动加载神武天帝的配置文件和文本
- **庄子示例**: 自动加载庄子的配置文件和文本

#### 3. 页面参数
- **起始页**: 从第几页开始生成（默认为1）
- **结束页**: 生成到第几页结束（0表示生成全部）
- **测试页数**: 测试模式，只生成指定页数（0表示正常模式）

#### 4. 选项
- **压缩PDF**: 生成后自动压缩PDF文件（需要Ghostscript）
- **详细输出**: 显示详细的处理信息
- **章节模式**: 启用章节标题自动识别和处理

#### 5. 控制按钮
- **生成PDF**: 开始生成PDF文件
- **清空日志**: 清空日志显示区域
- **打开结果目录**: 打开results文件夹
- **退出**: 关闭程序

#### 6. 处理日志
- 显示PDF生成过程的详细信息
- 包含进度条显示处理进度
- 显示字体加载、文本处理、页面生成等状态

### 书籍ID模式GUI界面

#### 1. 书籍选择区域
- **书籍ID**: 从下拉列表选择书籍ID（如：01、02、03等）
- **刷新书籍列表**: 重新扫描books目录
- **快速选择按钮**: 史记(01)、碧血剑(02)、庄子(03)、神武天帝(04)

#### 2. 文本参数
- **起始文本**: 从第几个文本文件开始（默认为1）
- **结束文本**: 到第几个文本文件结束
- **测试页数**: 测试模式，只生成指定页数（0表示正常模式）

#### 3. 选项
- **压缩PDF**: 生成后自动压缩PDF文件（需要Ghostscript）
- **详细输出**: 显示详细的处理信息

#### 4. 书籍信息显示
- **标题**: 显示选中书籍的标题
- **作者**: 显示选中书籍的作者
- **背景**: 显示使用的背景图片ID
- **文本文件数**: 显示books/ID/text/目录下的文本文件数量

#### 5. 控制按钮
- **生成PDF**: 开始生成PDF文件
- **清空日志**: 清空日志显示区域
- **打开结果目录**: 打开results文件夹
- **打开books目录**: 打开books文件夹
- **帮助**: 显示使用说明
- **退出**: 关闭程序

#### 6. 处理日志
- 显示PDF生成过程的详细信息
- 实时显示处理进度和状态
- 显示字体加载、文本处理、页面生成等状态

## 使用步骤

### 单文件模式使用
1. 启动单文件模式GUI程序（`run_gui.py` 或 `vrain_gui.py`）
2. 选择文本文件和配置文件（必需）
3. 选择封面文件（可选，留空将自动创建简易封面）
4. 设置页面参数（可选）
5. 选择需要的选项
6. 点击"生成PDF"按钮
7. 等待处理完成
8. 在results目录中查看生成的PDF文件

### 书籍ID模式使用
1. 启动书籍ID模式GUI程序（`run_back_gui.py` 或 `vrain_back_gui.py`）
2. 从下拉列表选择书籍ID（如：01、02、03等）
3. 设置起始和结束文本序号
4. 选择需要的选项
5. 点击"生成PDF"按钮
6. 等待处理完成
7. 在books/ID/目录中查看生成的PDF文件

### 使用示例配置

#### 单文件模式示例
1. 启动单文件模式GUI
2. 点击"史记示例"按钮，自动加载史记的配置
3. 点击"生成PDF"按钮
4. 等待处理完成

#### 书籍ID模式示例
1. 启动书籍ID模式GUI
2. 点击"史记(01)"按钮，自动选择史记
3. 点击"生成PDF"按钮
4. 等待处理完成

### 自定义配置

#### 单文件模式自定义
1. 启动单文件模式GUI
2. 点击"浏览"按钮选择您的文本文件和配置文件
3. 可选择封面文件，或留空让程序自动创建简易封面
4. 根据需要调整页面参数
5. 选择压缩选项（推荐）
6. 点击"生成PDF"按钮

#### 书籍ID模式自定义
1. 启动书籍ID模式GUI
2. 从下拉列表选择书籍ID
3. 设置起始和结束文本序号
4. 选择压缩选项（推荐）
5. 点击"生成PDF"按钮

## 配置文件说明

### 书籍配置文件（book.cfg）
```ini
# 基本信息
title=史记
author=司马迁
canvas_id=01_Black

# 字体配置
font1=HanaMinA.ttf
font2=HanaMinB.ttf
text_font1_size=42
comment_font1_size=30

# 排版参数
row_num=30
row_delta_y=10
if_nocomma=0
if_onlyperiod=0

# 章节模式
enable_chapter_mode=1
```

### 背景配置文件（canvas/*.cfg）
```ini
# 页面尺寸
canvas_width=2480
canvas_height=1860

# 边距设置
margins_top=200
margins_bottom=50
margins_left=50
margins_right=50

# 列数设置
leaf_col=24
leaf_center_width=120
```

## 注意事项

1. **文件路径**: 确保文本文件和配置文件路径正确，文件存在
2. **编码格式**: 文本文件必须使用UTF-8编码
3. **字体文件**: 确保fonts目录中有相应的字体文件
4. **权限**: 确保程序有权限读取和写入文件
5. **磁盘空间**: 确保有足够的磁盘空间存储生成的PDF文件
6. **封面文件**: 封面文件是可选的，如果未提供或文件不存在，程序会自动创建简易封面
7. **字体格式**: reportlab不支持PostScript轮廓的OTF字体，请使用TTF格式字体
8. **PDF压缩**: 压缩功能需要安装Ghostscript
9. **GUI环境**: 确保系统支持tkinter图形界面
10. **书籍目录**: 书籍ID模式需要books目录下有正确命名的子目录（如01、02等）

## 常见问题

### Q: 程序无法启动
A: 检查Python版本和依赖包是否正确安装，运行`python test_back_gui.py`进行环境检查

### Q: 文件选择后显示错误
A: 检查文件是否存在，路径是否正确

### Q: 生成PDF时出错
A: 查看日志信息，检查配置文件和字体文件

### Q: 生成的PDF文件过大
A: 勾选"压缩PDF"选项（需要安装Ghostscript）

### Q: 字体显示异常
A: 检查fonts目录中的字体文件是否完整，确保使用TTF格式

### Q: 中文字符显示为方块
A: 检查字体文件是否支持相应的中文字符，程序会自动尝试简繁转换

### Q: 章节标题没有正确识别
A: 确保文本中的章节标题格式为"第X章 标题名"，并启用章节模式

### Q: GUI界面显示异常
A: 检查系统是否支持tkinter，某些Linux发行版可能需要安装python3-tk包

### Q: 书籍列表为空
A: 检查books目录是否存在，确保books目录下的子目录命名格式正确（应为数字，如01、02等）

### Q: 处理过程中界面卡死
A: 这是正常现象，程序使用多线程处理，界面会在处理完成后恢复正常

## 技术支持

如果遇到问题，请：
1. 查看处理日志中的错误信息
2. 检查文件路径和配置
3. 确保所有依赖包已正确安装
4. 参考命令行版本的文档
5. 检查字体文件是否完整且格式正确
6. 运行`python test_back_gui.py`进行环境检查
7. 检查系统是否支持tkinter图形界面

### 环境检查
运行以下命令检查环境配置：
```bash
python test_back_gui.py
```

### 依赖包安装
```bash
pip install reportlab Pillow opencc-python-reimplemented
```

### Linux系统额外依赖
某些Linux发行版可能需要安装tkinter：
```bash
# Ubuntu/Debian
sudo apt-get install python3-tk

# CentOS/RHEL
sudo yum install python3-tkinter
```

## 版本信息

- GUI版本: v1.4-GUI / v1.4-GUI-Back
- 基于: vRain Python版本 v1.4-Python
- 界面框架: tkinter
- 支持平台: Windows、macOS、Linux
- 作者: GitHub@shanleiguang, 小红书@兀雨书屋
- Python版本转换: msyloveldx

## 更新日志

### v1.4.2 (2025-08-26)
- 🖥️ 新增图形界面支持
- 🎯 新增单文件模式GUI（基于vrain.py）
- 📚 新增书籍ID模式GUI（基于vrain_back.py）
- 🔄 支持实时日志显示和进度反馈
- 🧪 新增GUI功能测试脚本
- 📖 完善GUI使用文档

### v1.4-Python
- 新增章节模式支持
- 改进字体检测和简繁转换
- 优化文本处理和排版算法
- 增强错误处理和日志输出
- 支持单文件模式和书籍ID模式
